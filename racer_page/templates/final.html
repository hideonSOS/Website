{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>選手紹介</title>
  <link rel="stylesheet" href="{% static 'racer_page/css/final.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
</head>
<body>

  <!-- ① Djangoデータを安全に埋め込み -->
  {{ context_data|json_script:"data-json" }}
  <script>
    // ② JSで解凍して配列に整形（キー順に並べ替え）
    const _ctx = JSON.parse(document.getElementById('data-json').textContent || '{}');
    const initialRacers = Object.keys(_ctx).sort().map(k => _ctx[k]).filter(Boolean);
  </script>

  <!-- ③ ここから先はVueで描画。Djangoは干渉させない -->
  {% verbatim %}
  <div id="app" class="container">
    <h1>優 勝 戦 メンバー</h1>
    <div class="players-grid">
      <div class="player-container" v-for="(r, i) in racers" :key="i">
        <div class="boat-number">{{ i + 1 }}号艇</div>
        <div class="player-card">
          <div class="player-photo">
            <img :src="`https://www.boatrace.jp/racerphoto/${r.toban}.jpg`" :alt="r.name || '選手'">
          </div>
          <div class="player-name">{{ r.name }}</div>
          <div class="player-number">{{ r.toban }}</div>
        </div>
      </div>
    </div>
  </div>
  {% endverbatim %}

  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return { racers: initialRacers };
      }
    }).mount('#app');
  </script>
</body>
</html>
