{% load static %}
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart.js + Vue (固定軸対応)</title>
    <!-- Vue3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
     <!-- Chart.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Chart.js Annotation plugin（Chart.jsの後に必ず読み込む） -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
  <link rel="stylesheet" href="{% static 'website/css/calc_tokuten2.css' %}">
  </head>
  <body>
    {% verbatim %}
    <div id="app" class="container">
      <!-- 左パネル -->
      <div class="left-panel">
        <h2>📊 入力</h2>
        <div>
          <label>ボーダー:</label>
          <input
            type="number"
            v-model.number="borderValue"
            min="0"
            max="13"
            step="0.01"
          />
        </div>
        <div v-for="(add, i) in adds" :key="i" style="margin-top: 10px">
          <label>{{ i+1 }} 号艇・着順点 : </label>
          <select v-model.number="adds[i].value">
            <option value="">未選択</option>
            <option v-for="n in 12" :key="n" :value="n">{{ n }}</option>
          </select>
          <br />

           <label>対象選手 : </label>
          <select v-model="adds[i].target">
            <option value="">未選択</option>
           <option v-for="name in nameOptions" :key="name" :value="name">
              {{ name }}
            </option>
          </select>

        </div>
          <!-- ▼ 合格ライン計算用のUIを左パネル下部に追加 -->
      <hr style="margin: 15px 0; border-color: #444;" />
      <div>
        <label>対象選手 (合格ライン計算):</label>
        <select v-model="selectedPlayer">
          <option value="">未選択</option>
          <option v-for="name in nameOptions" :key="name" :value="name">
            {{ name }}
          </option>
        </select>
      </div>
      <div style="margin-top: 8px;">
        <label>残り出走回数:</label>
        <select v-model.number="remainingRaces">
          <option :value="1">1</option>
          <option :value="2">2</option>
        </select>
      </div>

<div v-if="selectedPlayer" style="margin-top: 8px;">
        <span :style="requiredPointsText.includes('無事故当確') ? 'color: limegreen; font-weight: bold;' : 'color: #fff;'">
          必要得点: {{ requiredPointsText }}
        </span>
      </div>




      </div>

      <!-- 右パネル -->
      <div class="right-panel">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <div>
            <h2>📈 得点率一覧表</h2>
            <p style="font-size: 12px; color: #fff">{{ currentTime }}</p>
          </div>
          <div>
            <!-- <button @click="updateData">更新</button> -->
            <button @click="toggleSort">
              {{ sortOrder ? "元に戻す ↺" : "降順 ▼" }}
            </button>
          </div>
        </div>

        <div class="chart-wrapper">
          <!-- スクロール領域 -->
          <div class="chart-scroll-area">
            <div class="chart-container">
              <canvas id="myChart"></canvas>
            </div>
          </div>
          <!-- 固定軸 -->
          <div class="chart-fixed-axis">
            <canvas id="axisChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    {% endverbatim %} 


    {{ df_data|json_script:'data-json' }}
    <script src="{% static 'website/js/calc_tokuten2.js' %}"></script>
  </body>
</html>
